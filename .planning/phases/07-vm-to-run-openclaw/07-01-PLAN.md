---
phase: 07-vm-to-run-openclaw
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: ["apps/dashboard/prisma/schema.prisma"]
autonomous: true

must_haves:
  truths:
    - "Users can create VM templates through template form UI"
    - "Users can store VM-specific configuration (BIOS, CPU, machine type) in the database"
    - "Template system distinguishes between LXC and VM templates for type-specific management"
  artifacts:
    - path: "apps/dashboard/prisma/schema.prisma"
      provides: "Extended Template model with VM support"
      contains: "templateType"
  key_links:
    - from: "apps/dashboard/prisma/schema.prisma"
      to: "Template model extensions"
      via: "templateType enum field"
      pattern: "templateType.*TemplateType"
---

<objective>
Extend the database schema to support VM templates alongside existing LXC templates.

Purpose: Enable storage and management of VM template configurations with type-specific fields while maintaining backward compatibility with existing LXC templates.
Output: Database schema supporting both LXC and VM templates with proper type validation.
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-vm-to-run-openclaw/07-RESEARCH.md
@apps/dashboard/prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend database schema for VM template support</name>
  <files>apps/dashboard/prisma/schema.prisma</files>
  <action>
    Add VM template support to existing Template model:
    
    1. Add TemplateType enum with values: lxc, vm
    2. Add templateType field to Template model (defaulting to 'lxc' for backward compatibility)
    3. Add VM-specific fields to Template model:
       - biosType: String? (seabios, ovmf for UEFI) 
       - cpuType: String? (host, kvm64, etc.)
       - machine: String? (pc, q35)
       - cloudInitStorage: String? (storage for cloud-init ISO)
       - efidisk: String? (UEFI variables storage)
    4. Update existing indexes to include templateType for efficient VM/LXC filtering
    
    Preserve all existing LXC fields - Template model supports both LXC and VM configs.
    Run prisma db push after schema changes.
  </action>
  <verify>npx prisma db push succeeds, npx prisma generate succeeds, prisma studio shows new VM fields</verify>
  <done>Template model supports both templateType enum and VM-specific configuration fields</done>
</task>

</tasks>

<verification>
- Database migration completes successfully with new VM fields
- Template model can store both LXC and VM template configurations
- Existing LXC templates remain unaffected
</verification>

<success_criteria>

- Template model supports both LXC and VM template types
- VM-specific configuration fields are available for template creation
- Database schema maintains backward compatibility with existing LXC templates
- Foundation ready for VM API integration and template management
  </success_criteria>

<output>
After completion, create `.planning/phases/07-vm-to-run-openclaw/07-01-SUMMARY.md`
</output>
