---
phase: 08-lxc-container-template-engine
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/forge-shield/scripts/10_node.sh
  - templates/forge-shield/scripts/11_python.sh
  - templates/forge-shield/scripts/12_go.sh
  - templates/forge-shield/scripts/13_rust.sh
autonomous: true

must_haves:
  truths:
    - "Node.js 22 LTS is installed and available system-wide"
    - "Python 3 with pipx is ready for CLI tool installations"
    - "Go is installed from official tarball and GOPATH configured"
    - "Rust is installed via rustup for the non-root user"
  artifacts:
    - path: "templates/forge-shield/scripts/10_node.sh"
      provides: "Node.js 22 installation via NodeSource"
      min_lines: 15
    - path: "templates/forge-shield/scripts/11_python.sh"
      provides: "Python 3 + pipx configuration"
      min_lines: 15
    - path: "templates/forge-shield/scripts/12_go.sh"
      provides: "Go installation from official tarball"
      min_lines: 15
    - path: "templates/forge-shield/scripts/13_rust.sh"
      provides: "Rust installation via rustup for non-root user"
      min_lines: 15
  key_links:
    - from: "templates/forge-shield/scripts/11_python.sh"
      to: "apt pipx package"
      via: "pipx installed from apt in engine package phase, 11_python runs pipx ensurepath"
      pattern: "pipx ensurepath"
    - from: "templates/forge-shield/scripts/10_node.sh"
      to: "NodeSource"
      via: "curl installer adds NodeSource apt repo for Node.js 22"
      pattern: "nodesource.*setup_22"
---

<objective>
Create the four language runtime installation scripts for the forge-shield template.

Purpose: These scripts install the core language runtimes (Node.js, Python tooling, Go, Rust) that all subsequent tool installation scripts depend on. They run inside the container as root but set up user-level tools where appropriate.
Output: 4 provisioning scripts in `templates/forge-shield/scripts/`
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-lxc-container-template-engine/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Node.js and Python setup scripts</name>
  <files>
    templates/forge-shield/scripts/10_node.sh
    templates/forge-shield/scripts/11_python.sh
  </files>
  <action>
Create two language installation scripts. Both must be executable, use `#!/usr/bin/env bash`, `set -euo pipefail`, and be idempotent. Scripts run as root inside the container. They receive `USERNAME` as an env var.

**10_node.sh** — Install Node.js 22 LTS:

- Guard: `command -v node &>/dev/null && [[ "$(node --version)" == v22.* ]]` → skip
- Install via NodeSource setup script: `curl -fsSL https://deb.nodesource.com/setup_22.x | bash -`
- `apt-get install -y nodejs`
- Verify: `node --version` and `npm --version`
- Set up npm global directory for user (avoid global installs as root):
  - `su - $USERNAME -c "mkdir -p ~/.npm-global"`
  - `su - $USERNAME -c "npm config set prefix '~/.npm-global'"`
- Log with `[10_node]` prefix

**11_python.sh** — Configure Python 3 with pipx:

- Guard: `command -v pipx &>/dev/null` → skip
- Python 3 is already installed via apt packages in the engine's package phase
- Ensure pipx is set up for the non-root user:
  - `apt-get install -y pipx` (if not already from packages phase — idempotent)
  - `su - $USERNAME -c "pipx ensurepath"` — adds ~/.local/bin to user's PATH
- Set PIPX_HOME and PIPX_BIN_DIR for the user:
  - These default to `~/.local/share/pipx` and `~/.local/bin` which is fine
- Verify: `su - $USERNAME -c "pipx --version"`
- Note: DO NOT use `pip install` directly — Ubuntu 24.04 enforces PEP 668. All Python CLI tools must use pipx.
- Log with `[11_python]` prefix
  </action>
  <verify>
  `bash -n templates/forge-shield/scripts/10_node.sh && bash -n templates/forge-shield/scripts/11_python.sh` — both pass syntax check.
  </verify>
  <done>10_node.sh installs Node.js 22 with user npm global dir. 11_python.sh configures pipx for PEP 668-compliant Python tool installation.</done>
  </task>

<task type="auto">
  <name>Task 2: Create Go and Rust setup scripts</name>
  <files>
    templates/forge-shield/scripts/12_go.sh
    templates/forge-shield/scripts/13_rust.sh
  </files>
  <action>
Create two more language installation scripts. Same conventions as Task 1.

**12_go.sh** — Install Go from official tarball:

- Guard: `command -v go &>/dev/null` → skip
- Determine latest stable Go version OR use a pinned version. Use Go 1.23.x (latest stable). Pin to a specific version like `GO_VERSION="1.23.6"` for reproducibility.
- Download: `wget -q "https://go.dev/dl/go${GO_VERSION}.linux-amd64.tar.gz" -O /tmp/go.tar.gz`
- Extract: `rm -rf /usr/local/go && tar -C /usr/local -xzf /tmp/go.tar.gz`
- Clean up: `rm /tmp/go.tar.gz`
- Set up Go environment for user:
  - Create `$USERNAME`'s go directory: `su - $USERNAME -c "mkdir -p ~/go/bin ~/go/src ~/go/pkg"`
- Verify: `/usr/local/go/bin/go version`
- Note: PATH additions handled by the engine's env phase (reads PATH_APPEND from template.yaml)
- Log with `[12_go]` prefix

**13_rust.sh** — Install Rust via rustup for non-root user:

- Guard: `su - $USERNAME -c "command -v rustc"` → skip (check as user, not root)
- Install rustup as the non-root user (NOT as root):
  - `su - $USERNAME -c "curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable"`
- Verify: `su - $USERNAME -c "source ~/.cargo/env && rustc --version && cargo --version"`
- Note: cargo bin dir is in PATH_APPEND from template.yaml
- Log with `[13_rust]` prefix
  </action>
  <verify>
  `bash -n templates/forge-shield/scripts/12_go.sh && bash -n templates/forge-shield/scripts/13_rust.sh` — both pass syntax check.
  </verify>
  <done>12_go.sh installs Go from official tarball to /usr/local/go. 13_rust.sh installs Rust via rustup for the non-root user. Both are idempotent.</done>
  </task>

</tasks>

<verification>
All 4 scripts pass `bash -n` syntax check and are executable. Each has an idempotent guard. Scripts use `$USERNAME` env var for user-level setup.
</verification>

<success_criteria>

- 10_node.sh: Node.js 22 installed, npm global dir configured for user
- 11_python.sh: pipx configured for user, PEP 668 compliant
- 12_go.sh: Go installed to /usr/local/go, user GOPATH set up
- 13_rust.sh: Rust installed via rustup for non-root user
- All scripts are idempotent with guard checks
  </success_criteria>

<output>
After completion, create `.planning/phases/08-lxc-container-template-engine/08-04-SUMMARY.md`
</output>
