---
phase: 08-lxc-container-template-engine
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/forge-shield/scripts/20_foundry.sh
  - templates/forge-shield/scripts/21_solc-select.sh
  - templates/forge-shield/scripts/30_claude-code.sh
  - templates/forge-shield/scripts/31_opencode.sh
  - templates/forge-shield/scripts/32_gsd-install.sh
autonomous: true

must_haves:
  truths:
    - "Foundry (forge, cast, anvil, chisel) is installed for the non-root user"
    - "solc-select is installed via pipx with a default Solidity version selected"
    - "Claude Code CLI is installed for the non-root user"
    - "OpenCode is installed for the non-root user"
    - "GSD workflow is cloned and installed for the non-root user"
  artifacts:
    - path: "templates/forge-shield/scripts/20_foundry.sh"
      provides: "Foundry EVM toolkit installation"
      min_lines: 15
    - path: "templates/forge-shield/scripts/21_solc-select.sh"
      provides: "Solidity compiler version manager"
      min_lines: 15
    - path: "templates/forge-shield/scripts/30_claude-code.sh"
      provides: "Claude Code CLI installation"
      min_lines: 10
    - path: "templates/forge-shield/scripts/31_opencode.sh"
      provides: "OpenCode installation"
      min_lines: 10
    - path: "templates/forge-shield/scripts/32_gsd-install.sh"
      provides: "GSD workflow installation"
      min_lines: 10
  key_links:
    - from: "templates/forge-shield/scripts/21_solc-select.sh"
      to: "templates/forge-shield/scripts/11_python.sh"
      via: "solc-select requires pipx (installed by 11_python.sh)"
      pattern: "pipx install solc-select"
    - from: "templates/forge-shield/scripts/31_opencode.sh"
      to: "templates/forge-shield/scripts/12_go.sh"
      via: "OpenCode fallback uses go install (requires Go from 12_go.sh)"
      pattern: "go install.*opencode"
    - from: "templates/forge-shield/scripts/30_claude-code.sh"
      to: "templates/forge-shield/scripts/10_node.sh"
      via: "Claude Code CLI requires Node.js runtime"
      pattern: "claude.ai/install"
---

<objective>
Create the EVM development tool scripts and AI/productivity tool scripts for the forge-shield template.

Purpose: These scripts install the core blockchain development tools (Foundry, solc-select) and AI-powered coding tools (Claude Code, OpenCode, GSD) that define the forge-shield template's identity as a smart contract + AI dev environment.
Output: 5 provisioning scripts in `templates/forge-shield/scripts/`
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-lxc-container-template-engine/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EVM development tool scripts</name>
  <files>
    templates/forge-shield/scripts/20_foundry.sh
    templates/forge-shield/scripts/21_solc-select.sh
  </files>
  <action>
Create two EVM tool installation scripts. Both must be executable, use `#!/usr/bin/env bash`, `set -euo pipefail`, be idempotent, and run as root inside the container. `USERNAME` env var is available.

**20_foundry.sh** — Install Foundry (forge, cast, anvil, chisel):

- Guard: `su - $USERNAME -c "command -v forge"` → skip with version info
- Install foundryup as the non-root user:
  - `su - $USERNAME -c "curl -L https://foundry.paradigm.xyz | bash"`
  - `su - $USERNAME -c "source ~/.bashrc && ~/.foundry/bin/foundryup"`
- Verify: `su - $USERNAME -c "~/.foundry/bin/forge --version"`
- Also verify cast, anvil, chisel exist in ~/.foundry/bin/
- Note: foundry binaries go to ~/.foundry/bin/ which is in PATH_APPEND
- Log with `[20_foundry]` prefix

**21_solc-select.sh** — Install solc-select and set default version:

- Guard: `su - $USERNAME -c "command -v solc-select"` → skip
- Install via pipx (pipx is set up by 11_python.sh): `su - $USERNAME -c "pipx install solc-select"`
- Install a default Solidity version: `su - $USERNAME -c "solc-select install 0.8.28 && solc-select use 0.8.28"`
- Verify: `su - $USERNAME -c "solc-select versions"` and `su - $USERNAME -c "solc --version"`
- Log with `[21_solc-select]` prefix
  </action>
  <verify>
  `bash -n templates/forge-shield/scripts/20_foundry.sh && bash -n templates/forge-shield/scripts/21_solc-select.sh` — both pass syntax check.
  </verify>
  <done>20_foundry.sh installs Foundry for user. 21_solc-select.sh installs solc-select via pipx with Solidity 0.8.28 as default.</done>
  </task>

<task type="auto">
  <name>Task 2: Create AI and productivity tool scripts</name>
  <files>
    templates/forge-shield/scripts/30_claude-code.sh
    templates/forge-shield/scripts/31_opencode.sh
    templates/forge-shield/scripts/32_gsd-install.sh
  </files>
  <action>
Create three AI/productivity tool installation scripts. Same conventions as Task 1.

**30_claude-code.sh** — Install Claude Code CLI:

- Guard: `su - $USERNAME -c "command -v claude"` → skip with version
- Install via official installer as the non-root user:
  - `su - $USERNAME -c "curl -fsSL https://claude.ai/install.sh | bash"`
- Verify: `su - $USERNAME -c "claude --version"` (may output version or help text)
- Note: Claude Code requires authentication post-install — this is expected and happens when user first uses it
- Log with `[30_claude-code]` prefix

**31_opencode.sh** — Install OpenCode:

- Guard: `su - $USERNAME -c "command -v opencode"` → skip
- Install via official installer as the non-root user:
  - `su - $USERNAME -c "curl -fsSL https://opencode.ai/install | bash"`
- If that fails, try the Go install method: `su - $USERNAME -c "go install github.com/opencode-ai/opencode@latest"`
- Verify: `su - $USERNAME -c "opencode --version || opencode --help"` (accept either as success)
- Log with `[31_opencode]` prefix

**32_gsd-install.sh** — Install GSD (Get Shit Done) workflow:

- Guard: check if `~/.config/Claude/get-shit-done/` exists for the user → skip
- Clone the GSD repository and run its installer as the user:
  - `su - $USERNAME -c "git clone https://github.com/clydeai-lab/get-shit-done.git /tmp/gsd-install"`
  - `su - $USERNAME -c "cd /tmp/gsd-install && bash install.sh"`
  - Clean up: `su - $USERNAME -c "rm -rf /tmp/gsd-install"`
- If clone fails (private repo or not available), try alternative approach:
  - Create the directory structure manually: `su - $USERNAME -c "mkdir -p ~/.config/Claude/get-shit-done"`
  - Log warning that GSD needs to be installed manually
- Verify: `su - $USERNAME -c "ls ~/.config/Claude/get-shit-done/"` shows files
- Log with `[32_gsd-install]` prefix
  </action>
  <verify>
  `bash -n templates/forge-shield/scripts/30_claude-code.sh && bash -n templates/forge-shield/scripts/31_opencode.sh && bash -n templates/forge-shield/scripts/32_gsd-install.sh` — all pass syntax check.
  </verify>
  <done>30_claude-code.sh installs Claude Code CLI. 31_opencode.sh installs OpenCode with fallback. 32_gsd-install.sh installs GSD workflow. All idempotent.</done>
  </task>

</tasks>

<verification>
All 5 scripts pass `bash -n` syntax check, are executable, and have idempotent guard checks. EVM tools install to user-owned directories. AI tools use official installers.
</verification>

<success_criteria>

- Foundry installed via foundryup to ~/.foundry/bin/
- solc-select installed via pipx with Solidity 0.8.28 default
- Claude Code installed via official curl installer
- OpenCode installed via curl or go install
- GSD installed to ~/.config/Claude/get-shit-done/
- All scripts are idempotent and run as user where needed
  </success_criteria>

<output>
After completion, create `.planning/phases/08-lxc-container-template-engine/08-05-SUMMARY.md`
</output>
