---
phase: 08-lxc-container-template-engine
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/forge-shield/scripts/50_claude-skills.sh
  - templates/forge-shield/scripts/60_shell-setup.sh
  - templates/forge-shield/scripts/99_verify.sh
autonomous: true

must_haves:
  truths:
    - "Claude skills (security commands) are set up for the user"
    - "Zsh with a usable shell setup is configured"
    - "99_verify.sh validates all critical tools are available"
  artifacts:
    - path: "templates/forge-shield/scripts/50_claude-skills.sh"
      provides: "Claude security skill commands setup"
      min_lines: 10
    - path: "templates/forge-shield/scripts/60_shell-setup.sh"
      provides: "Zsh configuration with useful defaults"
      min_lines: 20
    - path: "templates/forge-shield/scripts/99_verify.sh"
      provides: "Final verification of all installed tools"
      min_lines: 30
  key_links:
    - from: "templates/forge-shield/scripts/60_shell-setup.sh"
      to: "templates/forge-shield/scripts/13_rust.sh"
      via: "Sources cargo env in .zshrc (requires Rust installed by 13_rust.sh)"
      pattern: "cargo/env"
    - from: "templates/forge-shield/scripts/60_shell-setup.sh"
      to: "templates/forge-shield/scripts/10_node.sh"
      via: "PATH includes npm-global (set up by 10_node.sh)"
      pattern: "npm-global"
    - from: "templates/forge-shield/scripts/99_verify.sh"
      to: "all prior scripts"
      via: "Checks all tools installed by scripts 10-60"
      pattern: "command -v (forge|node|slither|semgrep)"
---

<objective>
Create the Claude skills setup, shell configuration, and final verification script for the forge-shield template.

Purpose: These scripts handle environment finalization — setting up Claude slash command directories, configuring zsh with oh-my-zsh and useful defaults, and running a comprehensive tool verification that confirms everything is working.
Output: 3 provisioning scripts in `templates/forge-shield/scripts/`
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-lxc-container-template-engine/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Claude skills and shell setup scripts</name>
  <files>
    templates/forge-shield/scripts/50_claude-skills.sh
    templates/forge-shield/scripts/60_shell-setup.sh
  </files>
  <action>
Create two provisioning scripts. Both must be executable, use `#!/usr/bin/env bash`, `set -euo pipefail`, be idempotent, run as root. `USERNAME` env var available.

**50_claude-skills.sh** — Set up Claude security skills/commands:

- Guard: check if `/home/$USERNAME/.claude/commands/` has files → skip
- This script creates the Claude slash command files and CLAUDE.md. However, the actual file CONTENTS are in the files/ directory and get pushed by the engine. So this script should:
  - Ensure the directories exist: `su - $USERNAME -c "mkdir -p ~/.claude/commands ~/.claude/skills"`
  - Set correct ownership
  - Log that files will be pushed by the engine's file push phase
- If you want to also install community security skills from GitHub:
  - `su - $USERNAME -c "git clone --depth 1 https://github.com/anthropics/claude-code-skills.git /tmp/claude-skills 2>/dev/null || true"`
  - Copy security-related skills if the repo exists: `su - $USERNAME -c "cp -r /tmp/claude-skills/security/* ~/.claude/skills/ 2>/dev/null || true"`
  - Clean up: `su - $USERNAME -c "rm -rf /tmp/claude-skills"`
- Log with `[50_claude-skills]` prefix

**60_shell-setup.sh** — Configure zsh with usable defaults:

- Guard: check if `/home/$USERNAME/.zshrc` exists and has been configured (grep for a marker comment) → skip
- Install oh-my-zsh for the user (popular, provides good defaults):
  ```
  su - $USERNAME -c 'sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended'
  ```
- Configure .zshrc with useful settings (append or create):
  - Set ZSH_THEME to a simple theme like "robbyrussell" (already default in oh-my-zsh)
  - Enable useful plugins: `plugins=(git docker node npm python rust golang fzf)`
  - Add PATH exports for all tool directories (foundry, cargo, go, npm-global, local/bin)
  - Add useful aliases:
    - `alias ll='ls -alF'`
    - `alias la='ls -A'`
    - `alias security-gate='~/.local/bin/security-gate.sh'`
    - `alias zap-scan='~/.local/bin/zap-scan.sh'`
  - Add a marker comment: `# forge-shield shell config`
  - Source cargo env if it exists: `[[ -f ~/.cargo/env ]] && source ~/.cargo/env`
- Change user's default shell to zsh: `chsh -s /bin/zsh $USERNAME`
- Ensure .zshrc is owned by user: `chown $USERNAME:$USERNAME /home/$USERNAME/.zshrc`
- Log with `[60_shell-setup]` prefix
  </action>
  <verify>
  `bash -n templates/forge-shield/scripts/50_claude-skills.sh && bash -n templates/forge-shield/scripts/60_shell-setup.sh` — both pass syntax check.
  </verify>
  <done>50_claude-skills.sh sets up Claude command directories. 60_shell-setup.sh configures zsh with oh-my-zsh and useful defaults.</done>
  </task>

<task type="auto">
  <name>Task 2: Create final verification script</name>
  <files>
    templates/forge-shield/scripts/99_verify.sh
  </files>
  <action>
Create the final verification script. Same conventions as Task 1.

**99_verify.sh** — Final verification of all installed tools:

- This is the last script to run. It checks every tool and produces a summary.
- Structure: list of tool checks with pass/fail reporting
- Check each tool (using `su - $USERNAME -c` for user-installed tools):
  - **Languages:** node, npm, python3, go, rustc, cargo
  - **EVM:** forge, cast, anvil, solc-select, solhint
  - **Security (web):** semgrep, trivy, gitleaks, nmap, nikto
  - **Security (Solidity):** slither, aderyn, echidna, myth (optional)
  - **AI:** claude, opencode (optional)
  - **Shell:** zsh
  - **ZAP:** check /opt/zaproxy/zap.sh exists
- For each tool: `command -v TOOL &>/dev/null && echo "  ✓ TOOL" || echo "  ✗ TOOL (NOT FOUND)"`
- Count passes/failures. Print summary: "X/Y tools verified"
- Exit 0 even if some optional tools failed (myth, opencode are optional)
- Exit 1 only if critical tools (node, python3, forge, slither) are missing
- Log with `[99_verify]` prefix
  </action>
  <verify>
  `bash -n templates/forge-shield/scripts/99_verify.sh` — passes syntax check.
  </verify>
  <done>99_verify.sh validates all tools and prints summary with pass/fail counts.</done>
  </task>

</tasks>

<verification>
All 3 scripts pass `bash -n` syntax check. Claude skills directories are set up. Zsh is configured with oh-my-zsh. 99_verify.sh checks every tool.
</verification>

<success_criteria>

- Claude skills directories created, community skills cloned if available
- Zsh configured with oh-my-zsh, useful plugins, tool PATH entries, aliases
- 99_verify.sh validates all tools with clear pass/fail output
  </success_criteria>

<output>
After completion, create `.planning/phases/08-lxc-container-template-engine/08-09-SUMMARY.md`
</output>
