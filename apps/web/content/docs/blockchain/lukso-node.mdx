---
title: LUKSO Node Setup
description: Full setup, configuration, monitoring, and maintenance guide for the LUKSO Docker node.
---

## Overview

This page covers the complete setup and operations for the LUKSO node defined in `infra/lukso-node/`. The node runs Geth (execution) and Lighthouse (consensus) with Prometheus and Grafana for monitoring.

## Repository structure

```
infra/lukso-node/
├── docker-compose.yml     # All 4 services
├── .env.example           # Configuration template
├── configs/
│   ├── genesis.json       # Execution layer genesis
│   ├── genesis.ssz        # Consensus layer genesis (downloaded by setup.sh)
│   ├── config.yaml        # Consensus layer config (chain ID 42, fork schedule)
│   ├── jwt.hex            # JWT secret (generated by setup.sh)
│   ├── deposit_contract_block.txt
│   └── deploy_block.txt
├── scripts/
│   ├── setup.sh           # Initial setup
│   ├── status.sh          # Check sync status
│   ├── reset.sh           # Reset and resync
│   └── check-updates.sh   # Check for client updates
├── prometheus/
│   └── prometheus.yml     # Scrape configs
└── grafana/
    └── provisioning/      # Auto-provisioned datasource and dashboard
```

## Setup script

Run `./scripts/setup.sh` to initialize:

1. Creates `.env` from `.env.example` (if not present)
2. Creates data directories under `$DATA_DIR` (`geth/` and `lighthouse/`)
3. Downloads `genesis.ssz` from the official LUKSO network-configs repository
4. Generates a unique JWT secret (`jwt.hex`) for client authentication
5. Makes all scripts executable

## Configuration

All settings are in `.env`:

| Variable                     | Default                                     | Description                          |
| ---------------------------- | ------------------------------------------- | ------------------------------------ |
| `DATA_DIR`                   | `/mnt/lukso-node`                           | Base path for all node data          |
| `LUKSO_NETWORK_ID`           | `42`                                        | LUKSO mainnet chain ID               |
| `GETH_VERSION`               | `v1.16.1`                                   | Geth Docker image tag                |
| `LIGHTHOUSE_VERSION`         | `v7.0.1`                                    | Lighthouse Docker image tag          |
| `GETH_NAT`                   | `any`                                       | NAT traversal method                 |
| `GETH_VERBOSITY`             | `3`                                         | Log verbosity (1=silent, 5=trace)    |
| `GETH_MAX_PEERS`             | `50`                                        | Maximum execution layer peers        |
| `LIGHTHOUSE_TARGET_PEERS`    | `100`                                       | Target consensus layer peers         |
| `CHECKPOINT_SYNC_URL`        | `https://checkpoints.mainnet.lukso.network` | Speeds up initial sync significantly |
| `EXECUTION_BOOTSTRAP_NODE_1` | (enode URL)                                 | Execution layer bootstrap node       |
| `EXECUTION_BOOTSTRAP_NODE_2` | (enode URL)                                 | Execution layer bootstrap node       |
| `CONSENSUS_BOOTSTRAP_NODE_1` | (ENR)                                       | Consensus layer bootstrap node       |
| `CONSENSUS_BOOTSTRAP_NODE_2` | (ENR)                                       | Consensus layer bootstrap node       |
| `PROMETHEUS_RETENTION`       | `30d`                                       | Metrics retention period             |
| `GRAFANA_PORT`               | `3000`                                      | Grafana web UI port                  |
| `GRAFANA_ADMIN_USER`         | `admin`                                     | Grafana admin username               |
| `GRAFANA_ADMIN_PASSWORD`     | —                                           | **Required**: Set a secure password  |

## Services

### Geth (execution client)

- **Image**: `ethereum/client-go:${GETH_VERSION}`
- **Auto-initialization**: On first start, checks for chaindata — if missing, runs `geth init` with the genesis file
- **Sync mode**: `snap` (syncs in hours, ~60 GB storage)
- **APIs**: `eth`, `net`, `web3`, `txpool` over HTTP, WebSocket, and GraphQL
- **Stop grace period**: 5 minutes (prevents database corruption)
- **Health check**: `wget http://localhost:8545` every 30 seconds

### Lighthouse (consensus client)

- **Image**: `sigp/lighthouse:${LIGHTHOUSE_VERSION}`
- **Depends on**: Geth being healthy
- **Checkpoint sync**: Uses `CHECKPOINT_SYNC_URL` for fast initial sync
- **Stop grace period**: 5 minutes
- **Health check**: `wget http://localhost:5052/eth/v1/node/health` every 30 seconds

### Prometheus

- **Image**: `prom/prometheus:latest`
- **Scrapes**: Geth metrics (port 6060) and Lighthouse metrics (port 5054) every 15 seconds
- **Retention**: Configurable via `PROMETHEUS_RETENTION` (default 30 days)
- **Bound to**: `127.0.0.1:9090` (localhost only)

### Grafana

- **Image**: `grafana/grafana:latest`
- **Port**: `${GRAFANA_PORT:-3000}`
- **Auto-provisioned**: Prometheus datasource and LUKSO Node dashboard are pre-configured
- **Dashboard metrics**: Sync status, peer counts, memory/disk usage, transaction pool, RPC rates, attestation metrics

## Endpoints

| Service               | Port  | Protocol  | Access          |
| --------------------- | ----- | --------- | --------------- |
| Geth HTTP RPC         | 8545  | HTTP      | Open            |
| Geth WebSocket        | 8546  | WS        | Open            |
| Geth GraphQL          | 8547  | HTTP      | Open            |
| Geth P2P              | 30303 | TCP + UDP | Open (required) |
| Lighthouse Beacon API | 5052  | HTTP      | Localhost only  |
| Lighthouse P2P        | 9000  | TCP + UDP | Open (required) |
| Prometheus            | 9090  | HTTP      | Localhost only  |
| Grafana               | 3000  | HTTP      | Configurable    |

## Helper scripts

### Check sync status

```bash
./scripts/status.sh
```

Reports:

- Geth sync status (syncing or synced at block N)
- Lighthouse sync status (syncing or synced at slot N)
- Peer counts for both clients

### Check for client updates

```bash
./scripts/check-updates.sh
```

Queries the GitHub API for the latest Geth and Lighthouse releases and shows current vs latest versions.

### Reset and resync

```bash
./scripts/reset.sh
```

Interactive script that:

1. Confirms you want to proceed
2. Stops all containers
3. Deletes Geth chaindata and triecache
4. Restarts containers

Use this if you encounter "invalid parent" errors or corrupted chain data. With snap sync, resyncing takes hours.

## Common operations

### View logs

```bash
docker compose logs -f geth
docker compose logs -f lighthouse
docker compose logs -f --tail=100  # All services
```

### Restart services

```bash
docker compose restart geth lighthouse
```

### Stop gracefully

```bash
docker compose down  # Waits up to 5 minutes
```

### Update clients

```bash
# Check for updates
./scripts/check-updates.sh

# Edit .env with new versions
nano .env

# Pull and restart
docker compose pull
docker compose up -d
```

### Regenerate JWT

```bash
openssl rand -hex 32 | sudo tee $DATA_DIR/configs/jwt.hex
docker compose restart geth lighthouse
```

## Data directory

```
/mnt/lukso-node/
├── geth/              # Execution client data (~60 GB for snap sync)
└── lighthouse/        # Consensus client data
```

## Full node vs archive node

This setup runs a **full node** (snap sync), which supports:

- Running a validator
- Sending transactions
- Querying current state
- Reading event logs
- Running dApps

You only need an archive node if you need historical state at arbitrary past blocks. Archive nodes require 1.8+ TB/year of storage.

## Security considerations

- Grafana and Prometheus are bound to `127.0.0.1` (not exposed externally)
- RPC endpoints (8545, 8546, 8547) are open — add firewall rules if the VM is network-accessible
- Beacon API (5052) is localhost-only
- Never expose the authrpc port (8551) publicly — it's used only for Geth-Lighthouse communication via JWT

## Troubleshooting

### "Failed to sync chain built on invalid parent"

Geth data is corrupted. Run `./scripts/reset.sh` to delete chaindata and resync.

### Lighthouse fails to start

Lighthouse depends on Geth being healthy. Check Geth status:

```bash
docker compose ps
curl http://localhost:8545
```

### Low peer count

- Ensure ports 30303 (TCP/UDP) and 9000 (TCP/UDP) are open on your router/firewall
- Geth auto-detects public IP with `--nat=any`
- Bootstrap nodes are pre-configured in `.env`

### High disk usage

Verify you're running snap sync (not archive):

```bash
docker compose exec geth geth --help | grep syncmode
```

This setup uses `--syncmode=snap` by default.
