---
title: Migration
description: Migrating from Coder workspaces, Docker Compose, bare-metal setups, and cloud IDEs to LXC containers.
---

## Overview

This guide helps you migrate from various development environment setups to LXC containers with git-based configuration management.

### Why Migrate to LXC?

**Benefits**:

- **Resource Efficiency**: 10-20% overhead vs 100%+ for VMs
- **Infrastructure as Code**: Everything in git, version-controlled
- **Automatic Updates**: Config sync on every boot
- **Snapshot/Rollback**: Built-in backup for instant recovery
- **Reproducibility**: Create identical environments on-demand

**Trade-offs**:

- Learning curve for git-based config management
- ProxmoxVE infrastructure required
- Linux-only (LXC shares host kernel)

## General Migration Principles

### Pre-migration Checklist

- [ ] List all tools and packages
- [ ] Document custom configurations
- [ ] Identify data to preserve
- [ ] Note critical credentials
- [ ] Test backup/restore procedures
- [ ] Plan for downtime

### Data Categories

1. **Code & Projects**: Git repositories, working directories
2. **Configuration**: Shell configs, tool settings, editor configs
3. **Credentials**: SSH keys, API tokens, certificates
4. **Data**: Databases, files, Docker volumes

### Migration Strategies

| Strategy           | Approach                            | Best For                             |
| ------------------ | ----------------------------------- | ------------------------------------ |
| **Clean Slate**    | Start fresh with declarative config | IaC benefits, clean environment      |
| **Lift-and-Shift** | Copy everything from old to new     | Fast migration, complex setups       |
| **Hybrid**         | Declarative tools + manual data     | Balance of speed and reproducibility |

## Migrating from Coder Workspaces

### Architecture Comparison

**Before: Coder Workspace (Docker container)**

```
Coder Server → Docker Container
    ├── VS Code Server
    ├── Persistent volume
    └── Terraform-provisioned
```

**After: LXC Container**

```
ProxmoxVE → LXC Container
    ├── VS Code Server (direct install)
    ├── Container filesystem (persistent)
    └── Config-manager (git-provisioned)
```

### Feature Mapping

| Coder Feature      | LXC Equivalent                   |
| ------------------ | -------------------------------- |
| Terraform template | container.sh + template.conf     |
| Dockerfile         | scripts/ + packages/             |
| Persistent volume  | Container root filesystem        |
| Workspace rebuild  | systemctl restart config-manager |

### Migration Steps

**Phase 1: Export from Coder**

```bash
# SSH into Coder workspace
coder ssh my-workspace

# 1. Push all git repos
cd ~/projects
for dir in */; do
    cd "$dir"
    git add .
    git commit -m "Pre-migration checkpoint" || true
    git push || echo "No remote for $dir"
    cd ..
done

# 2. Backup dotfiles
tar -czf ~/dotfiles-backup.tar.gz ~/.bashrc ~/.zshrc ~/.vimrc ~/.gitconfig ~/.ssh/

# 3. Export VS Code extensions
code-server --list-extensions > ~/vscode-extensions.txt

# 4. Document installed tools
dpkg -l | grep ^ii > ~/installed-packages.txt
```

**Phase 2: Create LXC Config**

Convert Coder Dockerfile to config-manager:

```bash
# From Dockerfile:
# RUN apt-get install -y curl git nodejs

# To packages/base.apt:
curl
git
nodejs
```

**Phase 3: Deploy LXC Container**

```bash
# On ProxmoxVE host
bash -c "$(curl -fsSL https://...)"
```

**Phase 4: Migrate Data**

```bash
# Get LXC IP
LXC_IP=$(pct exec <container-id> ip addr show eth0 | grep 'inet ' | awk '{print $2}' | cut -d/ -f1)

# Copy projects
rsync -av --progress ~/projects/ coder@$LXC_IP:~/projects/

# Copy dotfiles
scp ~/dotfiles-backup.tar.gz coder@$LXC_IP:~/
ssh coder@$LXC_IP 'tar -xzf ~/dotfiles-backup.tar.gz -C ~/'
```

**Phase 5: Verify**

```bash
ssh coder@$LXC_IP

# Verify tools
docker --version
node --version

# Test project build
cd ~/projects/my-app && npm install && npm run build
```

### Performance Comparison

| Metric          | Coder (Docker) | LXC      | Difference |
| --------------- | -------------- | -------- | ---------- |
| Memory overhead | 100-200 MB     | 20-50 MB | -60%       |
| Boot time       | 10-15s         | 5-8s     | -50%       |
| Disk space      | 3-4 GB         | 2-3 GB   | -25%       |

## Migrating from Docker Compose

### Pattern Conversion

**Docker Compose**:

```yaml
services:
  dev:
    image: node:20
    volumes:
      - ./:/workspace
    ports:
      - "3000:3000"
```

**LXC Config-Manager**:

```bash
# packages/base.apt
nodejs
npm

# scripts/10-setup-workspace.sh
mkdir -p /workspace
chown coder:coder /workspace
```

## Migrating from Bare Metal / VM

### Steps

1. **Inventory packages**: `dpkg --get-selections > packages.txt`
2. **Convert to APT format**: `awk '{print $1}' packages.txt > base.apt`
3. **Extract dotfiles**: Copy to `files/` with `.path` and `.policy`
4. **Document custom installations**: Convert to `.custom` installers
5. **Backup databases**: `pg_dumpall`, `mysqldump`, etc.
6. **Deploy LXC**: Use container.sh
7. **Restore data**: SCP projects and database dumps

## Data Transfer Methods

### SSH/SCP

```bash
# Single file
scp file.txt user@lxc-ip:~/

# Directory with progress
rsync -av --progress ~/projects/ user@lxc-ip:~/projects/
```

### Git Push/Pull

```bash
# Push from old environment
git add .
git commit -m "Pre-migration"
git push

# Pull in new environment
git clone https://github.com/user/repo.git
```

### Docker Volume Export/Import

```bash
# Export
docker run --rm -v my-volume:/data -v $(pwd):/backup alpine \
    tar czf /backup/my-volume.tar.gz /data

# Import in LXC
docker volume create my-volume
docker run --rm -v my-volume:/data -v ~/:/backup alpine \
    tar xzf /backup/my-volume.tar.gz -C / --strip-components=1
```

## Post-Migration

### Validation Checklist

- [ ] All tools installed (`docker --version`, `node --version`, etc.)
- [ ] Projects clone and build successfully
- [ ] Shell environment familiar (aliases, prompt)
- [ ] SSH keys and credentials work
- [ ] Config-manager syncing (`systemctl status config-manager`)
- [ ] Databases accessible (`psql -l`, `redis-cli ping`)

### Optimization

```bash
# Remove unused packages
apt-mark showmanual > manually-installed.txt
# Review and remove unneeded

# Configure snapshot retention
vim /etc/config-manager/config.env
SNAPSHOT_RETENTION_DAYS="30"

# Add custom automation
cat > container-configs/scripts/95-auto-start.sh <<'EOF'
#!/usr/bin/env bash
cd ~/projects/my-app && docker-compose up -d
EOF
```

## Troubleshooting Migration

### Missing Packages

```bash
# Search for correct name
apt-cache search <tool>

# Add to packages/base.apt
echo "<package>" >> container-configs/packages/base.apt

# Commit and sync
git commit -am "Add missing package"
git push
systemctl restart config-manager
```

### Dotfiles Not Applied

```bash
# Remove file to let config-manager deploy
rm ~/.bashrc

# Or change policy to replace
echo "replace" > container-configs/files/bashrc.policy
git commit -am "Force replace bashrc"
git push
systemctl restart config-manager
```

### Docker Not Working

```bash
# Install Docker
echo "docker.io" >> container-configs/packages/base.apt

# Add user to group
sudo usermod -aG docker $USER
newgrp docker
```

## Case Studies

### Web3 Developer Migrating from Coder

**Background**: Node.js, Foundry, Hardhat workload

**Process**:

1. Inventory (1 hour)
2. Create config (2 hours)
3. Deploy & migrate (1 hour)
4. Optimize (30 minutes)

**Results**:

- ✅ 4.5 hour total migration
- ✅ 40% memory reduction
- ✅ Faster boot (15s → 6s)
- ✅ Git-managed config for easy replication

### Team Migrating from Local VMs

**Background**: 5 developers, standardization needed

**Process**:

1. Standardization (1 week)
2. Rollout (2 days)
3. Iteration (ongoing)

**Results**:

- ✅ Consistent environments
- ✅ Onboarding: 1 day → 1 hour
- ✅ Team-wide tool updates via git
- ✅ 80% reduction in "works on my machine"

## Full Documentation

For the complete migration guide including more source types, detailed examples, and troubleshooting, see:

**[infra/lxc/docs/MIGRATION.md](https://github.com/kethalia/pve-home-lab/blob/main/infra/lxc/docs/MIGRATION.md)**
