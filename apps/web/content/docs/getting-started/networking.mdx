---
title: Network Topology
description: How the home lab network is structured, including VLANs, port mapping, and external access via WireGuard.
---

## Overview

The home lab uses a combination of local networking and a WireGuard VPN tunnel to a public VPS for external access. This page describes the overall topology. For detailed WireGuard setup, see the [Networking section](/docs/networking).

## Network diagram

```
Internet
    │
    ▼
┌──────────────────┐
│  Public VPS      │
│  (WireGuard +    │
│   port forward)  │
│  10.0.0.2        │
└────────┬─────────┘
         │ WireGuard tunnel (UDP)
         │
┌────────┴─────────┐
│  Home Server     │
│  (Proxmox VE)    │
│  10.0.0.1        │
│                  │
│  ┌────────────┐  │
│  │ NPM (LXC)  │  │ ← ports 80, 443
│  │ Reverse    │  │
│  │ Proxy      │  │
│  └─────┬──────┘  │
│        │         │
│  ┌─────┴──────┐  │
│  │ Services   │  │
│  │ (VMs/LXCs) │  │
│  └────────────┘  │
└──────────────────┘
```

## How external access works

1. A public VPS runs WireGuard and forwards ports 80 and 443 through the tunnel to the home server
2. On the home server, [Nginx Proxy Manager](/docs/networking/wireguard) (NPM) receives the traffic and routes it to the correct service based on the domain name
3. Services are only exposed on their internal ports — NPM handles TLS termination and proxying

This means you can point DNS records at the VPS IP and access home lab services with valid HTTPS certificates, without exposing your home IP address.

## Internal network

All VMs and containers communicate over Proxmox's default Linux bridge (`vmbr0`). Services that need to talk to each other use Docker networks or direct IP access.

### Service ports reference

| Service | VM/LXC | Internal port | Notes |
|---|---|---|---|
| Open WebUI | AI VM | 8080 | LLM chat interface |
| Ollama | AI VM | 11434 | LLM API |
| Kokoro | AI VM | 3000 | TTS API |
| ComfyUI | AI VM | 8188 | Image generation |
| Jellyfin | Media VM | 8096 | Media player |
| qBittorrent | Media VM | 5080 | Behind VPN |
| Prowlarr | Media VM | 9696 | Behind VPN |
| Radarr | Media VM | 7878 | Movie manager |
| Sonarr | Media VM | 8989 | TV manager |
| Bazarr | Media VM | 6767 | Subtitles |
| Sunshine | Gaming VM | 47984-47990 | Game streaming |
| Geth RPC | Blockchain VM | 8545 | JSON-RPC |
| Geth P2P | Blockchain VM | 30303 | Peer discovery |
| Lighthouse P2P | Blockchain VM | 9000 | Peer discovery |
| Grafana | Blockchain VM | 3000 | Monitoring |
| Dokploy | Deployment LXC | 3000 | PaaS dashboard |
| Coder | Dev LXC | 3000 | Dev workspaces |
| NPM Admin | NPM LXC | 81 | Proxy manager UI |

### Ports that must be open on your router

| Port | Protocol | Destination | Purpose |
|---|---|---|---|
| 30303 | TCP + UDP | Blockchain VM | Geth P2P |
| 9000 | TCP + UDP | Blockchain VM | Lighthouse P2P |
| 51821 | UDP | Home server | WireGuard tunnel |

All other services are accessed through the WireGuard tunnel and NPM reverse proxy — no additional ports need to be forwarded.

## DNS

Point your domain's DNS records at the public VPS IP. Use NPM to create proxy hosts that route `service.yourdomain.com` to the correct internal service and port. NPM handles Let's Encrypt certificate issuance and renewal automatically.
